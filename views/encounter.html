<!DOCTYPE html>
<html lang="en" ng-app="clientApp" style="height: 100%">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="generator" content="Bootply"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="bower_components/angular-motion/dist/angular-motion.min.css">
    <link rel="stylesheet" href="/bower_components/angular-material/angular-material.css">
    <link rel="stylesheet" href="stylesheet/encounter.css">
    <link href="stylesheet/style.css" rel="stylesheet">

    <!--angular-material dependencies-->
    <script src="bower_components/angular/angular.js"></script>
    <script src="/bower_components/angular-aria/angular-aria.js"></script>
    <script src="bower_components/angular-animate/angular-animate.min.js"></script>
    <script src="bower_components/angular-material/angular-material.js"></script>

    <!--<script src="bower_components/angular/angular.min.js"></script>-->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="bower_components/angular-sanitize/angular-sanitize.min.js"></script>
    <script src="bower_components/angular-strap/dist/angular-strap.min.js"></script>
    <script src="bower_components/angular-strap/dist/angular-strap.tpl.min.js"></script>
    <script src="bower_components/angular-bootstrap/ui-bootstrap-tpls.min.js"></script>
    <script src="bower_components/ng-flow/dist/ng-flow-standalone.min.js"></script>
    <script src="bower_components/angular-mousewheel/mousewheel.js"></script>
    <script src="bower_components/hamsterjs/hamster.js"></script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="javascript/app/encounterApp.js"></script>
    <script src="javascript/service/profileService.js"></script>
    <script src="javascript/service/encounterService.js"></script>
    <script src="javascript/control/headerController.js"></script>
    <script src="javascript/socketFactory.js"></script>
    <script src="javascript/service/encounterSocketService.js"></script>
    <script src="javascript/map/mapRenderer.js"></script>
    <script src="javascript/map/gridRenderer.js"></script>
    <script src="javascript/map/tokenRenderer.js"></script>
    <script src="javascript/map/highlightRenderer.js"></script>
    <script src="javascript/map/noteRenderer.js"></script>
    <script src="javascript/map/inputController.js"></script>
    <script src="javascript/control/encounterController.js"></script>

    <title>Dungeon Map</title>
</head>
<body style="display: flex; height: 100%; flex-direction: column;">

<!--Top Menu Container-->
<nav class="navbar navbar-static navbar-inverse" style="margin: 0px;">
    <div class="container">
        <div class="nav-collapse collase">
            <ul class="nav navbar-nav navbar-left">
                <li><a href="home">Home</a></li>
                <li><a href="campaignList">Campaign</a></li>
                <li><a href="profile">Profile</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources <i
                            class="fa fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <!--<li><a href="pdf/Players Handbook 5E.pdf" target="_blank">Player's Handbook</a></li>-->
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-right navbar-nav">
                <li class="dropdown" ng-controller="headerController">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span ng-bind="name"></span> <i
                            class="fa fa-user"></i> <i
                            class="fa fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <li><a href="login">Logout</a></li>
                        <li><a href="#">Profile</a></li>
                        <li class="divider"></li>
                        <li><a href="#">About</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Content Space -->
<div ng-controller="encounterController" style="margin-right: 5px; margin-left: 5px; display: flex; flex-direction: column; flex:1">

    <!-----------------------------------------------------------------------------------------------------
    Sidebar Content
    ------------------------------------------------------------------------------------------------------->
    <md-sidenav class="md-sidenav-left" md-component-id="side_menu" md-whiteframe="4">
        <!--Encounter Settings-->
        <md-toolbar class="md-theme-indigo">
            <h1 class="md-toolbar-tools">Encounter</h1>
        </md-toolbar>
        <md-list flex>
            <md-list-item class="disabled" ng-show="isHost()" ng-click="null">Upload Map</md-list-item>
            <md-list-item ng-click="addCharacter()">Add Character</md-list-item>
            <md-list-item ng-show="isHost()" ng-click="addNPC()">Add NPC</md-list-item>
            <md-list-item ng-show="isHost()" ng-click="toggleEncounterState()">
                <span ng-if="!getEncounterState().active">Open Encounter</span>
                <span ng-if="getEncounterState().active">Close Encounter</span>
            </md-list-item>
            <md-list-item ng-click="toggleGrid()">
                <span ng-if="gridState()">Disable Grid</span>
                <span ng-if="!gridState()">Enable Grid</span>
            </md-list-item>

        </md-list>

        <!--Light Settings-->
        <md-toolbar class="md-theme-indigo">
            <h1 class="md-toolbar-tools">Light</h1>
        </md-toolbar>
        <md-list>
            <md-list-item ng-click="null" class="disabled">Toggle Light</md-list-item>
            <md-list-item ng-click="null" class="disabled">Light/Visibility Pen</md-list-item>
        </md-list>
    </md-sidenav>


    <!-----------------------------------------------------------------------------------------------------
    Title Bar
    ------------------------------------------------------------------------------------------------------->
    <div style="margin-bottom:5px; display:flex">
        <!--Menu Toggle Button-->
        <md-button class="md-raised" ng-click="toggleMenu()" style="background-color:white; height:40px; align-self: center;">Menu</md-button>
        <!--Title Span-->
        <span ng-bind="getEncounterState().title" style="align-self: center; margin:auto; font-size: 3em; font-weight: bold;font-family: 'breathe_fire', sans-serif;"></span>
        <!--Encounter State Span-->
        <span ng-if="!getEncounterState().active" style="color: red;align-self: center; font-size: 2em; font-weight: bold;font-family: 'breathe_fire', sans-serif; margin-right: 5px">Closed</span>
    </div>

    <!-----------------------------------------------------------------------------------------------------
    Map Row
    ------------------------------------------------------------------------------------------------------->
    <div style="display: flex; flex:1; margin-bottom: 5px">

        <!--Player Status Nav-->
        <div style="display:flex; flex-direction:column; flex: 0 0 375px; margin-right: 5px; margin-bottom: 0px;">
            <!--Blue Players Tag-->
            <div>
                <li class="list-group-item active" style="display: flex; padding-top: 5px; padding-bottom: 5px">
                    <span class="h4_inline" style="margin-right: auto;">Players</span>
                    <i class="fa fa-bolt fa-2x" style="align-self: center"></i></h4>
                </li>
            </div>
            <!--List of Players-->
            <div class="initiative-box" style="flex:1; overflow-y: scroll;">
                <!--Player Status Bar-->
                <div class="list-group" ng-model="openedPlayerPanelIndex" role="tablist" aria-multiselectable="true" bs-collapse>
                    <div ng-repeat="player in getEncounterState().players | orderBy:'-initiative'"
                        ng-hide="!isHost() && !player.visible">
						<div class="list-group-item" style="display: flex; flex-flow: row; justify-content: flex-start;
                            padding-left: 5px; padding-right: 10px; border-left: 10px solid {{ getColor(player) }}; {{ isHovered(player) }}"
                             ng-mouseenter="setHover(player)" ng-click="selectPlayer(player)"
                             ng-mouseleave="removeHover()">
                            <span bs-collapse-toggle data-toggle="collapse" ng-show="hasRightsForPlayer(player)">
                                <i class="fa fa-chevron-right" style="align-self: flex-start" ng-if="!panelIsOpen($index)"></i>
                                <i class="fa fa-chevron-down" style="align-self: flex-start" ng-if="panelIsOpen($index)"></i>
                            </span>
                            <span style="width: 35%; align-self: center; margin-right: auto; padding-left: 5px">
								<span ng-if="player.hitPoints < 1" style="color:red">
									<strike ng-bind="player.name"></strike>
								</span>
								<span ng-if="player.hitPoints > 0" ng-bind="player.name"></span>
							</span>
							<span style="width: 45%; display: flex; flex-flow: row; padding-left: 5px; margin-right: auto">
                                <span style="width: 60%">
                                    <span ng-if="isMyCharacter(player) || isHost()" data-placement="bottom" ng-click="selectPlayer(player)"
                                          data-template-url="modal/playerHealPopover.html" data-auto-close="1"
                                          bs-popover style="cursor: pointer; flex: 1">
                                        <i class="fa fa-heart"></i>
                                    </span>
                                    <span ng-if="!isHost() && !isMyCharacter(player)">
                                        <i class="fa fa-heart"></i>
                                    </span>
                                    <span ng-if="!isHost() && player.npc" style="flex: 1">???
                                        <span ng-if="(player.hitPoints - player.maxHitPoints) < 0" style="color: red">  <span ng-bind="player.hitPoints - player.maxHitPoints"></span> </span>
                                        <span ng-if="(player.hitPoints - player.maxHitPoints) > 0" style="color: green">  +<span ng-bind="player.hitPoints - player.maxHitPoints"></span> </span>
                                        <span ng-if="(player.hitPoints - player.maxHitPoints) === 0"> </span>
                                    </span>
                                    <span ng-if="isHost() || !player.npc">
                                        <span ng-if="player.hitPoints < 1" style="color: dimgrey" ng-bind="player.hitPoints"></span>
                                        <span ng-if="player.hitPoints >= player.maxHitPoints" style="color: green"
                                        ng-bind="player.hitPoints"></span>
                                        <span ng-if="player.hitPoints < player.maxHitPoints && player.hitPoints > 0"
                                        style="color: red" ng-bind="player.hitPoints"></span>
                                        / <span ng-bind="player.maxHitPoints"></span>
                                    </span>
                                </span>
                                <span style="width: 40%;">
                                    <i class="fa fa-shield"></i>
                                    <span ng-if="!isHost() && player.npc">??? </span>
                                    <span ng-if="isHost() || !player.npc"
                                          ng-bind="player.armorClass"> </span>
                                </span>
							</span>
							<span style="width: 18%; display: flex; justify-content: flex-end; padding-left: 5px">
								<a href="#" ng-show="isHost() && player.npc && player.visible" ng-click="toggleVisible(player)">
									<i class="fa fa-eye"></i>
								</a>
								<a href="#" ng-show="isHost() && player.npc && !player.visible" ng-click="toggleVisible(player)">
									<i class="fa fa-eye-slash"></i>
								</a>
                                <span style="padding-left: 5px">
                                    <span ng-if="isHost() || isMyCharacter(player)" class="badge" ng-click="selectPlayer(player)"
                                    data-template-url="modal/initiativePopover.html" data-auto-close="1" style="cursor: pointer"
                                    data-placement="left" bs-popover>
                                        <i class="fa fa-bolt" ng-click="selectPlayer(player)"></i>
                                        <span ng-bind="player.initiative" ng-click="selectPlayer(player)"></span>
                                    </span>
                                    <span ng-if="!isHost() && !isMyCharacter(player)" class="badge">
                                        <i class="fa fa-bolt"></i>
                                        <span ng-bind="player.initiative"></span>
                                    </span>
                                </span>
								<a href="#" ng-show="isHost()" ng-click="removePlayer(player)" style="color: black; padding-left: 5px">
									<i class="fa fa-close"></i>
								</a>
							</span>
						</div>
                        <!--Player info collapse panel-->
                        <div class="panel-collapse" role="tabpanel" ng-show="hasRightsForPlayer(player)" bs-collapse-target>
                            <div class="panel-body" style="display: flex; flex-flow: column; border: 1px solid #ddd;">
                                <div class="playerPanelRow">
                                    <span style="flex: 1">
                                        <i class="fa fa-user"></i>
                                        <span class="playerPanelAttribute">Name:</span>
                                    </span>
                                    <input ng-model="player.name" ng-blur="updatePlayer(player)" class="md-input playerPanelInput" style="flex: 1">
                                </div>
                                <div class="playerPanelRow">
                                    <i class="fa fa-eye"></i>
                                    <span class="playerPanelAttribute">Passive Perception:</span>
                                    <input ng-model="player.passivePerception" ng-blur="updatePlayer(player)" class="md-input playerPanelInput">
                                </div>
                                <div class="playerPanelRow">
                                    <i class="fa fa-heart"></i>
                                    <span class="playerPanelAttribute">Max HP:</span>
                                    <input ng-model="player.maxHitPoints" ng-blur="updatePlayer(player)" class="md-input playerPanelInput">
                                </div>
                                <div class="playerPanelRow">
                                    <i class="fa fa-shield"></i>
                                    <span class="playerPanelAttribute">Armor Class:</span>
                                    <input ng-model="player.armorClass" ng-blur="updatePlayer(player)" class="md-input playerPanelInput">
                                </div>
                                <div class="playerPanelRow">
                                    <span class="playerPanelAttribute" style="flex: 1">Movement Speed:</span>
                                    <span style="flex: 1; display: flex; justify-content: flex-end">
                                        <input ng-model="player.speed" ng-blur="updatePlayer(player)" class="md-input playerPanelInput" style="width: 84px">
                                        <md-switch aria-label="movement speed" class="md-primary" style="margin: 0px" role="checkbox"></md-switch>
                                    </span>
                                </div>
                                <div class="playerPanelRow" role="tablist" aria-multiselectable="true" bs-collapse>
                                    <span bs-collapse-toggle data-toggle="collapse">
                                        <i class="fa fa-chevron-right" style="align-self: flex-start"></i>
                                        <!--<i class="fa fa-chevron-down" style="align-self: flex-start" ng-if="player.openAttackPanel === 0"></i>-->
                                    </span>
                                    <div class="panel-collapse" role="tabpanel" bs-collapse-target="">
                                        Attack content here!!!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-----------------------------------------------------------------------------------------------------
            Notations Section
            ------------------------------------------------------------------------------------------------------->
            <div>
                <li ng-click="toggleNotes()" class="list-group-item active" style="background-color: #cc4733; border-color: #cc4733; display: flex; padding-top: 5px; padding-bottom: 5px">
                    <span class="h4_inline" style="margin-right: auto;">Notations</span>
                    <md-menu style="align-self: center">
                        <i class="fa fa-bars fa-2x" ng-click="$mdMenu.open($event)"></i>
                        <md-menu-content>
                            <md-menu-item>
                                <md-button ng-click="addNote()">New Notation</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button class="selected_note" ng-if="getNoteMode() === 'sphere'" ng-click="toggleSphereMode()" md-prevent-menu-close="md-prevent-menu-close">Sphere Mode</md-button>
                                <md-button ng-if="getNoteMode() !== 'sphere'" ng-click="toggleSphereMode()" md-prevent-menu-close="md-prevent-menu-close">Sphere Mode</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button ng-disabled="true" md-prevent-menu-close="md-prevent-menu-close">Square Mode</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button ng-disabled="true" md-prevent-menu-close="md-prevent-menu-close">Cone Mode</md-button>
                            </md-menu-item>
                            <md-menu-item>
                                <md-button ng-click="decreaseNoteSize()" style="min-width: 1%;" md-prevent-menu-close="md-prevent-menu-close">
                                    <div style="font-size: 25px; text-align: center">-</div>
                                </md-button>
                                <div style="max-width: 100px; min-width: 100px; font-size: 25px; text-align: center; flex: 8">{{note_size}}</div>
                                <md-button ng-click="increaseNoteSize()" style="min-width: 1%" md-prevent-menu-close="md-prevent-menu-close">
                                    <div style="font-size: 25px; text-align: center">+</div>
                                </md-button>
                            </md-menu-item>
                        </md-menu-content>
                    </md-menu>
                </li>
            </div>

            <div class="initiative-box" style="flex:1; overflow-y: scroll;" ng-show="notes_collapsed">
                <ul class="list-group">
                    <li ng-repeat="note in getNotes()" ng-if="isNotePublic(note) || isNoteOwner(note)" class="list-group-item" style="border-left: 10px solid {{note.color}}; padding-left: 0; padding-top:0; padding-bottom: 0;">
                        <div style="display: flex; height: 42px; padding-left: 7px; border-left: 1px #dddddd solid">

                            <input ng-if="isNoteOwner(note)" ng-model="note.text" ng-blur="onChangeText(note)" class="md-input" style="align-self: center; margin-right: auto; border:0 solid white;">
                            <span ng-if="!isNoteOwner(note)" style="align-self: center; margin-right: auto;">{{note.text}}</span>

                            <span style="align-self: center; justify-content: flex-end">
                                <md-menu ng-if="isNoteOwner(note)" style="align-self: center; margin-left: 5px;">
                                    <i class="fa fa-paint-brush" ng-click="$mdMenu.open($event)"></i>
                                    <md-menu-content width="5">
                                        <md-grid-list md-cols="10" md-row-height="25px" style="margin: 5px;">
                                            <!--REDS-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 0, 0, 0.1);" ng-click="note.color='rgba(255, 0, 0, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 0, 0, 0.3);" ng-click="note.color='rgba(255, 0, 0, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 0, 0, 0.5);" ng-click="note.color='rgba(255, 0, 0, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 0, 0, 0.7);" ng-click="note.color='rgba(255, 0, 0, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 0, 0, 1.0);" ng-click="note.color='rgba(255, 0, 0, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(178, 34, 34, 0.1);" ng-click="note.color='rgba(178, 34, 34, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(178, 34, 34, 0.3);" ng-click="note.color='rgba(178, 34, 34, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(178, 34, 34, 0.5);" ng-click="note.color='rgba(178, 34, 34, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(178, 34, 34, 0.7);" ng-click="note.color='rgba(178, 34, 34, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(178, 34, 34, 1.0);" ng-click="note.color='rgba(178, 34, 34, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                            <!--ORANGES-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 165, 0, 0.1);" ng-click="note.color='rgba(255, 165, 0, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 165, 0, 0.3);" ng-click="note.color='rgba(255, 165, 0, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 165, 0, 0.5);" ng-click="note.color='rgba(255, 165, 0, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 165, 0, 0.7);" ng-click="note.color='rgba(255, 165, 0, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 165, 0, 1.0);" ng-click="note.color='rgba(255, 165, 0, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 140, 0, 0.1);" ng-click="note.color='rgba(255, 140, 0, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 140, 0, 0.3);" ng-click="note.color='rgba(255, 140, 0, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 140, 0, 0.5);" ng-click="note.color='rgba(255, 140, 0, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 140, 0, 0.7);" ng-click="note.color='rgba(255, 140, 0, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 140, 0, 1.0);" ng-click="note.color='rgba(255, 140, 0, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                            <!--YELLOW-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 0, 0.1);" ng-click="note.color='rgba(255, 255, 0, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 0, 0.3);" ng-click="note.color='rgba(255, 255, 0, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 0, 0.5);" ng-click="note.color='rgba(255, 255, 0, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 0, 0.7);" ng-click="note.color='rgba(255, 255, 0, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 0, 1.0);" ng-click="note.color='rgba(255, 255, 0, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 215, 0, 0.1);" ng-click="note.color='rgba(255, 215, 0, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 215, 0, 0.3);" ng-click="note.color='rgba(255, 215, 0, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 215, 0, 0.5);" ng-click="note.color='rgba(255, 215, 0, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 215, 0, 0.7);" ng-click="note.color='rgba(255, 215, 0, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 215, 0, 1.0);" ng-click="note.color='rgba(255, 215, 0, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                            <!--GREENS-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(50, 205, 50, 0.1);" ng-click="note.color='rgba(50, 205, 50, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(50, 205, 50, 0.3);" ng-click="note.color='rgba(50, 205, 50, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(50, 205, 50, 0.5);" ng-click="note.color='rgba(50, 205, 50, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(50, 205, 50, 0.7);" ng-click="note.color='rgba(50, 205, 50, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(50, 205, 50, 1.0);" ng-click="note.color='rgba(50, 205, 50, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 128, 0, 0.1);" ng-click="note.color='rgba(0, 128, 0, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 128, 0, 0.3);" ng-click="note.color='rgba(0, 128, 0, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 128, 0, 0.5);" ng-click="note.color='rgba(0, 128, 0, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 128, 0, 0.7);" ng-click="note.color='rgba(0, 128, 0, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 128, 0, 1.0);" ng-click="note.color='rgba(0, 128, 0, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                            <!--BLUES-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(135, 206, 250, 0.1);" ng-click="note.color='rgba(135, 206, 250, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(135, 206, 250, 0.3);" ng-click="note.color='rgba(135, 206, 250, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(135, 206, 250, 0.5);" ng-click="note.color='rgba(135, 206, 250, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(135, 206, 250, 0.7);" ng-click="note.color='rgba(135, 206, 250, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(135, 206, 250, 1.0);" ng-click="note.color='rgba(135, 206, 250, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 139, 0.1);" ng-click="note.color='rgba(0, 0, 139, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 139, 0.3);" ng-click="note.color='rgba(0, 0, 139, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 139, 0.5);" ng-click="note.color='rgba(0, 0, 139, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 139, 0.7);" ng-click="note.color='rgba(0, 0, 139, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 139, 1.0);" ng-click="note.color='rgba(0, 0, 139, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                            <!--PURPLES-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(218, 112, 214, 0.1);" ng-click="note.color='rgba(218, 112, 214, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(218, 112, 214, 0.3);" ng-click="note.color='rgba(218, 112, 214, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(218, 112, 214, 0.5);" ng-click="note.color='rgba(218, 112, 214, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(218, 112, 214, 0.7);" ng-click="note.color='rgba(218, 112, 214, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(218, 112, 214, 1.0);" ng-click="note.color='rgba(218, 112, 214, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(75, 0, 130, 0.1);" ng-click="note.color='rgba(75, 0, 130, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(75, 0, 130, 0.3);" ng-click="note.color='rgba(75, 0, 130, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(75, 0, 130, 0.5);" ng-click="note.color='rgba(75, 0, 130, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(75, 0, 130, 0.7);" ng-click="note.color='rgba(75, 0, 130, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(75, 0, 130, 1.0);" ng-click="note.color='rgba(75, 0, 130, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                            <!--BROWNS-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(210, 180, 140, 0.1);" ng-click="note.color='rgba(210, 180, 140, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(210, 180, 140, 0.3);" ng-click="note.color='rgba(210, 180, 140, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(210, 180, 140, 0.5);" ng-click="note.color='rgba(210, 180, 140, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(210, 180, 140, 0.7);" ng-click="note.color='rgba(210, 180, 140, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(210, 180, 140, 1.0);" ng-click="note.color='rgba(210, 180, 140, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(102, 75, 40, 0.1);" ng-click="note.color='rgba(102, 75, 40, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(102, 75, 40, 0.3);" ng-click="note.color='rgba(102, 75, 40, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(102, 75, 40, 0.5);" ng-click="note.color='rgba(102, 75, 40, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(102, 75, 40, 0.7);" ng-click="note.color='rgba(102, 75, 40, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(102, 75, 40, 1.0);" ng-click="note.color='rgba(102, 75, 40, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->
                                            <!--BLACK AND WHITES-->
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 255, 0.1);" ng-click="note.color='rgba(255, 255, 255, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 255, 0.3);" ng-click="note.color='rgba(255, 255, 255, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 255, 0.5);" ng-click="note.color='rgba(255, 255, 255, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 255, 0.7);" ng-click="note.color='rgba(255, 255, 255, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(255, 255, 255, 1.0);" ng-click="note.color='rgba(255, 255, 255, 1.0)'; updateNote(note)"></md-grid-tile>

                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 0, 0.1);" ng-click="note.color='rgba(0, 0, 0, 0.1)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 0, 0.3);" ng-click="note.color='rgba(0, 0, 0, 0.3)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 0, 0.5);" ng-click="note.color='rgba(0, 0, 0, 0.5)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 0, 0.7);" ng-click="note.color='rgba(0, 0, 0, 0.7)'; updateNote(note)"></md-grid-tile>
                                            <md-grid-tile md-colspan="1" md-rowspan="1" style="border: 1px solid #dddddd; background: rgba(0, 0, 0, 1.0);" ng-click="note.color='rgba(0, 0, 0, 1.0)'; updateNote(note)"></md-grid-tile>
                                        </md-grid-list>
                                    </md-menu-content>
                                </md-menu>

                                <span ng-if="isNoteOwner(note) && isHost()" style="margin-left: 5px; align-self: center">
                                    <span ng-if="!canNoteHide(note)"><i ng-click="toggleVisibilityControl(note)" class="fa fa-lock"></i></span>
                                    <span ng-if="canNoteHide(note)"><i ng-click="toggleVisibilityControl(note)" class="fa fa-unlock"></i></span>
                                </span>

                                <span ng-if="isNoteOwner(note)" style="margin-left: 5px; align-self: center">
                                    <span ng-if="!isNotePublic(note)"><i ng-click="toggleNotePublic(note)" class="fa fa-eye-slash"></i></span>
                                    <span ng-if="isNotePublic(note)"><i ng-click="toggleNotePublic(note)" class="fa fa-eye"></i></span>
                                </span>

                                <span ng-if="isNoteOwner(note) || isHost()" style="margin-left: 5px; align-self: center">
                                    <span ng-if="isNoteSelected(note)"><i ng-click="toggleNoteSelected(note)" class="fa fa-pencil-square"></i></span>
                                    <span ng-if="!isNoteSelected(note)"><i ng-click="toggleNoteSelected(note)" class="fa fa-pencil"></i></span>
                                </span>

                                <span style="margin-left: 5px; align-self: center">
                                    <span ng-if="getNoteVisibility(note) === 'locked'"><i ng-click="toggleVisibilitySetting(note)" class="fa fa-ban"></i></span>
                                    <span ng-if="getNoteVisibility(note) === 'full'"><i ng-click="toggleVisibilitySetting(note)" class="fa fa-circle"></i></span>
                                    <span ng-if="getNoteVisibility(note) === 'ghost'"><i ng-click="toggleVisibilitySetting(note)" class="fa fa-dot-circle-o"></i></span>
                                    <span ng-if="getNoteVisibility(note) === 'off'"><i ng-click="toggleVisibilitySetting(note)" class="fa fa-circle-o"></i></span>
                                </span>

                                <md-menu style="align-self: center; margin-left: 5px;">
                                    <i class="fa fa-cog" ng-click="$mdMenu.open($event)"></i>
                                    <md-menu-content>
                                        <md-menu-item ng-if="isNoteOwner(note) || isHost()">
                                            <md-button ng-click="removeNote(note)">Delete Notation</md-button>
                                        </md-menu-item>

                                        <md-menu-item ng-if="isNoteOwner(note) || isHost()">
                                            <md-button ng-click="toggleNoteSelected(note)">Select Notation</md-button>
                                        </md-menu-item>

                                        <md-menu-item>
                                            <md-button ng-if="getNoteVisibility(note) === 'full'" md-prevent-menu-close="md-prevent-menu-close" ng-click="toggleVisibilitySetting(note)"><b>View:</b> Full</md-button>
                                            <md-button ng-if="getNoteVisibility(note) === 'ghost'" md-prevent-menu-close="md-prevent-menu-close" ng-click="toggleVisibilitySetting(note)"><b>View:</b> Ghost</md-button>
                                            <md-button ng-if="getNoteVisibility(note) === 'off'" md-prevent-menu-close="md-prevent-menu-close" ng-click="toggleVisibilitySetting(note)"><b>View:</b> Off</md-button>
                                            <md-button ng-if="getNoteVisibility(note) === 'locked'" md-prevent-menu-close="md-prevent-menu-close" ng-click="toggleVisibilitySetting(note)" ng-disabled="true"><b>View:</b> Control Disabled</md-button>
                                        </md-menu-item>

                                         <md-menu-item ng-if="isNoteOwner(note)">
                                            <md-button ng-if="isNotePublic(note)" ng-click="toggleNotePublic(note)"><b>Sharing:</b> Public</md-button>
                                            <md-button ng-if="!isNotePublic(note)" ng-click="toggleNotePublic(note)"><b>Sharing:</b> Private</md-button>
                                        </md-menu-item>

                                        <md-menu-item ng-if="isHost() && isNoteOwner(note)">
                                            <md-button ng-if="!canNoteHide(note)" ng-click="toggleVisibilityControl(note)"><b>View Control:</b> Locked </md-button>
                                            <md-button ng-if="canNoteHide(note)" ng-click="toggleVisibilityControl(note)"><b>View Control:</b>Unlocked</md-button>
                                        </md-menu-item>

                                    </md-menu-content>
                                </md-menu>

                            </span>


                        </div>
                    </li>
                </ul>
            </div>
        </div>


        <!-----------------------------------------------------------------------------------------------------
        Map Section
        ------------------------------------------------------------------------------------------------------->
        <div ng-if="getEncounterState().mapURL" style="height: 100%; width: 100%">

            <div style="overflow: hidden; background-color: #dedede; height: 100%;">
                <div style="position: relative; height: 100%" id="mapDiv">

                    <div ng-controller="mapRenderer">
                        <canvas ng-init="init()" style="z-index:0; position:absolute;" id="mapCanvas" width={{get_res_x()}} height={{get_res_y()}}></canvas>
                    </div>

                    <div ng-controller="highlightRenderer">
                        <canvas ng-init="init()" style="z-index:1; position:absolute;" id="highlightCanvas" width={{get_res_x()}} height={{get_res_y()}}></canvas>
                    </div>

                    <div ng-controller="gridRenderer">
                        <canvas ng-init="init()" style="z-index:2; position:absolute;" id="gridCanvas" width={{get_res_x()}} height={{get_res_y()}}></canvas>
                    </div>

                    <div ng-controller="noteRenderer">
                        <canvas ng-init="init()" style="z-index:3; position:absolute;" id="noteCanvas" width={{get_res_x()}} height={{get_res_y()}}></canvas>
                    </div>

                    <div ng-controller="tokenRenderer">
                        <canvas ng-init="init()" style="z-index:4; position:absolute;" id="tokenCanvas" width={{get_res_x()}} height={{get_res_y()}}></canvas>
                    </div>

                    <div ng-controller="inputController">
                        <canvas style="z-index:5; position:absolute; width: 100%; height: 100%"
                                id="inputCanvas"
                                ng-click="click($event)"
                                ng-init='init()'
                                ng-mousemove="mouseMove($event)"
                                msd-wheel="mouseScroll($event, $delta, $deltaX, $deltaY)"
                                ng-mousedown="mouseDown($event)"
                                ng-mouseup="mouseUp()"
                                ng-mouseenter="mouseEnter()"
                                ng-mouseleave="mouseLeave()">
                        </canvas>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>